"use strict";var angularApp=angular.module("Admin",["angular-growl","ngRoute","restangular","ui.bootstrap"]).config(["$routeProvider","RestangularProvider","$locationProvider",function(e,o,a){o.setBaseUrl("/api"),a.hashPrefix("!"),e.when("/",{templateUrl:"admin-app/views/home.html",controller:"HomeController"}).when("/profile",{templateUrl:"admin-app/profile/profilev1.html",controller:"profileCtrl"}).when("/modulos",{templateUrl:"admin-app/views/modules/modulos.html",controller:"ModuloCtrl"}).when("/grupos",{templateUrl:"admin-app/views/grupos/view-read-groups.html",controller:"grupoReadCtrl"}).when("/grupos/create",{templateUrl:"admin-app/views/grupos/view-create-groups.html",controller:"grupoCreateCtrl"}).when("/usuarios",{templateUrl:"admin-app/views/usuario/view-crud-read.html",controller:"usuarioReadCtrl"}).when("/usuario/edit/:id",{templateUrl:"admin-app/views/usuario/view-crud-update.html",controller:"usuarioEditCtrl"}).when("/recovery/:token",{templateUrl:"admin-app/profile/view-modal-recovery-password.html",controller:"recoveryCtrl"}).when("/stock",{templateUrl:"admin-app/views/stock/view-read-stock.html",controller:"stockReadCtrl"}).otherwise({redirectTo:"/"})}]);angularApp.controller("MainCtrl",["$scope","Restangular","GlobalFactory","$modal","$rootScope","$location","$timeout",function(e,o,a,t,r){e.log=!1,e.name="CCA FONSOFT",a.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.getUsuarioList=function(){var a=o.one("user/listPermission");a.get().then(function(o){e.permission=o,angular.forEach(e.permission,function(o){1==o.id&&(e.perfiles="1"==o.list),2==o.id&&(e.permisos="1"==o.list),3==o.id&&(e.usuarioMod="1"==o.list),4==o.id&&(e.stock="1"==o.list),4==o.id&&(e.contactos="1"==o.list)})})},e.$watch(function(){return r.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage(),e.getUsuarioList())});var n=!1;e.toggleButton=function(){n?(console.log("SUBE"),$("#menu").stop().slideToggle("slow"),$("#toggle").removeClass("on"),n=!1):($("#menu").slideDown(100),$("#toggle").toggleClass("on",200),n=!0)},$(".dropdown-toggle").click(function(){$(".dropdown-perfil").slideToggle("slow")}),e.openLoginModal=function(){t.open({templateUrl:"admin-app/views/login/view-modal-login.html",controller:"LoginCtrl",backdrop:"static",windowClass:"normal-modal",keyboard:!0,scope:e}).result.then(function(){a.reload()})},e.openRegisterModal=function(){t.open({templateUrl:"admin-app/views/register/register.html",controller:"RegisterCtrl",backdrop:"static",windowClass:"normal-modal",keyboard:!0,scope:e}).result.then(function(){a.reload()})};var l=!1;e.toggleButton1=function(){l?(console.log("SUBE"),$("#toggle1").removeClass("on"),$("#nav").stop().animate({width:"89px",height:"100%"},"slow"),$(".container").stop().animate({marginLeft:"8%"},"slow"),$(".index-footer").stop().animate({marginLeft:"0px"},"slow"),$("#nav").toggleClass("hidden-xs",20),l=!1):($("#toggle1").toggleClass("on",200),$("#nav").removeClass("hidden-xs"),$("#nav").animate({width:"250px",height:"100%"},"slow"),$(".container").animate({marginLeft:"310px"},"slow"),$(".index-footer").animate({marginLeft:"220px"},"slow"),l=!0)},screen.width>=750&&$("#nav").css("width","89px")}]),angularApp.factory("GlobalFactory",["$rootScope","Restangular","$location","$route",function(e,o,a,t){e.notifications=[{link:"#/dsada",description:"dadasdasd"},{link:"#",description:"12356126357"}],e.locationSide="home";var r={};return r.init=function(){e.loggedUser||o.one("user/check").get().then(function(o){e.loggedUser="null"==o?null:o})},r.getUser=function(){return e.loggedUser},r.reload=function(){t.reload()},r}]),angularApp.directive("confirmButton",["$document","$parse",function(e,o){return{restrict:"A",link:function(a,t,r){var n,l,s,i,c,u;return n=Math.floor(1e10*Math.random()),r.buttonId=n,s=r.message||"¿Está seguro?",u=r.yes||"Sí",i=r.no||"No",c=r.title||"<i class='fa fa-question-circle'></i> Confirmación",l='<div style="width: 130px;" id="button-'+n+'">\n  <div class="confirmbutton-msg">'+s+'</div><br><button type="button" class="confirmbutton-yes btn btn-success"><span class="fa fa-thumbs-o-up"></span> '+u+'</button>\n	<button type="button" class="confirmbutton-no btn btn-warning"><i class="fa fa-thumbs-o-down"></i> '+i+"</button>\n</div>",t.popover({content:l,html:!0,trigger:"manual",title:c,placement:"top"}),t.bind("click",function(l){var s,i;s=!0,l.stopPropagation(),t.popover("show"),i=$("#button-"+n),i.closest(".popover").click(function(e){s&&e.stopPropagation()}),i.find(".confirmbutton-yes").click(function(){s=!1;var e=o(r.confirmButton);e(a)}),i.find(".confirmbutton-no").click(function(){s=!1,e.off("click.confirmbutton."+n),t.popover("hide")}),e.on("click.confirmbutton."+n,":not(.popover, .popover *)",function(){e.off("click.confirmbutton."+n),t.popover("hide")})})}}}]),angularApp.controller("HomeController",["$scope","$modal","GlobalFactory","$location","$rootScope","Restangular","$rootScope",function(e,o,a,t,r){a.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.homeLocation="/"==t.path()?!0:!1,e.$watch(function(){return r.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())})}]),angularApp.controller("LoginCtrl",["$scope","$modalInstance","Restangular","$location","GlobalFactory","$modal",function(e,o,a,t,r,n){e.modalInstance=o,r.init(),null!=e.loggedUser&&t.path("/"),e.loginCheck=!1;var l=a.all("user/login");e.login=function(a){e.user=a?{email:e.email,password:e.password,check:!0}:{email:e.email,password:e.password,check:!1},l.post(e.user).then(function(e){null==e?alert("Los datos ingresados son incorrectos o la cuenta esta desactivada. Por favor, ingrese datos válidos."):o.close()},function(e){console.log(e)})},e.input="password",e.change=function(){e.input=e.loginCheck?"text":"password"},e.openPasswordModal=function(){n.open({templateUrl:"admin-app/views/login/view-modal-recuperar-contraseña.html",controller:"passwordCtrl",backdrop:"static",windowClass:"normal-modal",keyboard:!0,scope:e}).result.then(function(){r.reload()})}}]),angularApp.controller("passwordCtrl",["$scope","$modalInstance","$rootScope","Restangular","GlobalFactory",function(e,o,a,t,r){e.modalInstance=o,r.init(),e.sendPassword=function(){var a=t.all("user/password/recovery");a.post({email:e.emailUser}).then(function(e){"exist"==e?(alert("Se ha enviado un mail a su casilla de correo para proceder"),o.close()):alert("El mail ingresado no corresponde a ninguna cuenta")})}}]),angularApp.controller("RegisterCtrl",["$scope","$modalInstance","Restangular","$location","GlobalFactory","$modal","$modalStack",function(e,o,a,t,r,n){e.modalInstance=o,e.checkRegister=!1,e.close=function(){o.close()},r.init(),null!=e.loggedUser&&t.path("/");var l=a.all("user/register");e.registroUser=function(){e.checkRegister?(e.user={name:e.userName,surname:e.userSurname,email:e.userEmail,phone:e.userPhone,password:e.userPassword},e.email=e.userEmail,l.post(e.user).then(function(t){if("registrado"==t){alert("Usted ha sido registrado correctamente. Sera logueado automaticamente.");var r=a.all("user/active");r.post(e.user);var l=a.all("user/login");l.post(e.user).then(function(e){e?o.close():alert("Los datos ingresados son incorrectos. Porfavor, ingrese datos válidos.")})}"en uso"==t&&alert("El email ingresado se encuentra en uso.Intente de nuevo"),"borrado"==t&&1==confirm("El e-mail proporcionado ya forma parte de una cuenta desactivada. ¿Desea re-activarla?.")&&n.open({templateUrl:"admin-app/profile/view-modal-reactivar-cuenta.html",controller:"ReactivarCuentaCtrl",backdrop:"static",windowClass:"small-dialog small-modal",keyboard:!0,scope:e,resolve:{Email:function(){return e.email}}}).result.then(function(){location.reload()})},function(e){console.log(e)})):alert("No has aceptado los términos y condiciones. Acépta los términos y condiciones si deseas continuar.")}}]),angularApp.controller("profileCtrl",["$scope","GlobalFactory","$location","$modal","$rootScope","Restangular","$route",function(e,o,a,t,r,n){o.init(),e.$watch(function(){return r.loggedUser},function(o){void 0!=r.loggedUser?e.user={name:o.name,surname:o.surname,email:o.email,phone:o.phone}:a.path("/")}),e.openUpdateUserDialog=function(){t.open({templateUrl:"admin-app/profile/view-modal-modificar-datos-usuario.html",controller:"ModificarDatosUsuarioCtrl",backdrop:"static",windowClass:"small-dialog small-modal",keyboard:!0,scope:e,resolve:{Usuario:function(){return e.user}}}).result.then(function(){o.reload(),location.reload(!0)})},e.openChangePasswordDialog=function(){t.open({templateUrl:"admin-app/profile/view-modal-cambiar-password.html",controller:"ModificarPasswordUsuarioCtrl",backdrop:"static",windowClass:"small-dialog small-modal",keyboard:!0,scope:e}).result.then(function(){o.reload()})},e.openCloseAccountDialog=function(){t.open({templateUrl:"admin-app/profile/view-modal-cerrar-cuenta.html",controller:"CerrarCuentaCtrl",backdrop:"static",windowClass:"small-dialog small-modal",keyboard:!0,scope:e}).result.then(function(){var e=n.one("user/logout");e.get(),console.log("logout"),a.path("/"),r.loggedUser=null,o.reload()})},e.openImageDialog=function(){t.open({templateUrl:"admin-app/profile/view-modal-cambiar-imagen.html",controller:"ProfileImageCtrl",backdrop:"static",windowClass:"large-modal",keyboard:!0,scope:e}).result.then(function(){o.reload(),location.reload(!0)})}}]),angularApp.controller("ModificarDatosUsuarioCtrl",["$scope","$modalInstance","Usuario","$rootScope","Restangular","GlobalFactory",function(e,o,a,t,r,n){e.modalInstance=o,n.init(),e.$watch(function(){return t.loggedUser},function(o,a){o!=a&&(e.loggedUser=o)}),e.no_changes=!0,e.modal={name:a.name,surname:a.surname,email:a.email,phone:a.phone},e.checkStatus=function(){e.no_changes=a.name==e.modal.name&&a.surname==e.modal.surname&&a.phone==e.modal.phone?!0:!1};var l=r.all("user/"+e.loggedUser.id+"/update");e.update=function(){l.post(e.modal).then(function(e){"updated"==e?(alert("Los datos se han actualizado correctamente"),o.close()):alert("Error al actualizar. Intentelo de nuevo")})}}]),angularApp.controller("ModificarPasswordUsuarioCtrl",["$scope","$modalInstance","$rootScope","Restangular","GlobalFactory",function(e,o,a,t,r){e.modalInstance=o,r.init(),e.$watch(function(){return a.loggedUser},function(o,a){o!=a&&(e.loggedUser=o)}),e.oldPassword="",e.newPassword="",e.newPasswordRepeat="",e.changePassword=function(){if(e.psword={oldPassword:e.oldPassword,newPassword:e.newPassword},e.newPassword==e.newPasswordRepeat){var a=t.all("user/updatePass");a.post(e.psword).then(function(e){"updated"==e?(alert("La contraseña se ha modificado correctamente"),o.close()):alert("Error. Intentelo de nuevo")})}else alert("Las contraseñas no coinciden")}}]),angularApp.controller("CerrarCuentaCtrl",["$scope","$modalInstance","$rootScope","Restangular","GlobalFactory",function(e,o,a,t,r){e.passwordUser="",e.modalInstance=o,r.init(),e.$watch(function(){return a.loggedUser},function(o,a){o!=a&&(e.loggedUser=o)});var n=t.all("user/delete");e.closeAccount=function(){e.user={email:e.loggedUser.email,password:e.passwordUser},n.post(e.user).then(function(e){"yes"==e?(alert("La cuenta ha sido desactivada"),o.close()):alert("La contraseña ingresada es incorrecta")})}}]),angularApp.controller("ReactivarCuentaCtrl",["$scope","$modalInstance","$rootScope","Restangular","GlobalFactory","Email",function(e,o,a,t,r,n){e.modalInstance=o,r.init(),e.$watch(function(){return a.loggedUser},function(o,a){o!=a&&(e.loggedUser=o)});var l=t.all("user/active");e.activeAccount=function(){e.user={email:n,password:e.passwordUser},l.post(e.user).then(function(e){"active"==e?(alert("La cuenta ha sido re-activada"),o.close()):alert("La contraseña ingresada es incorrecta")})}}]),angularApp.controller("recoveryCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$routeParams","$location",function(e,o,a,t,r,n){t.init();var l=r.token;console.log(l);var s=a.one("user/verify/"+l);s.get().then(function(o){"error"==o?n.path("/"):e.email=o}),e.newPassword="",e.newPasswordRepeat="",e.recoveryPassword=function(){if(e.newPassword==e.newPasswordRepeat){e.psword={newPassword:e.newPassword,newPasswordRepeat:e.newPasswordRepeat,email:e.email};var o=a.all("user/updateRecovery");o.post(e.psword).then(function(e){"error"!=e?(alert("La contraseña se ha modificado correctamente"),n.path("/login")):alert("Error. Intentelo de nuevo")})}else alert("Las contraseñas no coinciden")}}]),angularApp.controller("ProfileImageCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$routeParams","$location","$modalInstance",function(e,o,a,t,r,n,l){e.modalInstance=l,t.init(),e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o)}),e.obj={},e.change=!0,e.change=function(){e.change=e.change?!1:!0},e.url="api/user/"+e.loggedUser.id+"/setImage"}]),angularApp.controller("ModuloCtrl",["$scope","Restangular","$location","GlobalFactory","$rootScope","$route",function(e,o,a,t,r,n){t.init(),void 0==r.loggedUser&&a.path("/"),e.change=!1,e.selected="Todos";var l=o.one("group");l.get().then(function(o){e.groups=o},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),a.path("/admin"))});var s=o.one("modulos/permisos");s.get().then(function(o){e.modulosObj=o,angular.forEach(e.modulosObj,function(e){e.read="1"==e.read,e.read_edit="1"==e.read_edit,e.create="1"==e.create,e.create_edit="1"==e.create_edit,e.update="1"==e.update,e.update_edit="1"==e.update_edit,e["delete"]="1"==e["delete"],e.delete_edit="1"==e.delete_edit,e.list="1"==e.list,e.list_edit="1"==e.list_edit,e.change=!1})}),e.filterGroup=function(o){0==o?s.get().then(function(o){e.modulosObj=o,e.selected="Todos"}):s.get({grupo_id:o}).then(function(o){e.modulosObj=o,e.selected=o[0].nombre_grupo})},e.filterBy=function(o){console.log(o);var a=!1,t={};return e.modulosObj.forEach(function(e){e.nombre_modulo==o&&(a=!0,t=e)}),1!=a?!1:!0},e.changeStatusModule=function(e,o){switch(o){case"read":e.read=!e.read;break;case"create":e.create=!e.create;break;case"update":e.update=!e.update;break;case"delete":e["delete"]=!e["delete"];break;case"list":e.list=!e.list}e.change=!0},e.updateModule=function(e){var t=o.all("modulos/permisos/update");t.post(e).then(function(e){"update"==e?(alert("Los datos se actualizaron corectamente"),n.reload()):alert("Error.Vuelva a intentarlo")},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),a.path("/admin"))})}}]),angularApp.controller("grupoReadCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","$modal","$timeout",function(e,o,a,t,r,n,l){t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png";var o=a.one("user/"+e.loggedUser.id+"/admin");o.get().then(function(){})},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin");var s=a.one("group");s.get().then(function(o){e.grupos=o},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))}),e.update=function(o){console.log(o),angular.forEach(e.grupos,function(a){a.id==o&&n.open({templateUrl:"admin-app/views/grupos/view-edit-groups.html",controller:"grupoEditCtrl",backdrop:"static",windowClass:"small-dialog big-modal",keyboard:!0,scope:e,resolve:{Grupo:function(){return a}}}).result.then(function(){t.reload(),location.reload(!0)})})},e.remove=function(e){l(function(){var o=a.all("group/"+e+"/delete");1==confirm("¿Esta seguro?")&&o.post().then(function(e){"deleted"==e&&(alert("El grupo se ha eliminado correctamente"),location.reload(!0))},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})})}}]),angularApp.controller("grupoCreateCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","$modal",function(e,o,a,t,r){t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin"),e.object={};var n=a.one("user/groups");n.get().then(function(o){e.grupos=o}),e.object.name="",e.notFound=!1,e.object.description="",e.create=function(){if(angular.forEach(e.grupos,function(o){o.name==e.object.name&&(alert("El grupo ya existe."),e.notFound=!0)}),!e.notFound){var o={name:e.object.name,description:e.object.description},t=a.all("group/store");t.post(o).then(function(e){"grupo creado"==e?(alert("El grupo ha sido creado sactifactoriamente"),r.path("/grupos")):alert("Hubo un error al crear el grupo. Intentelo de nuevo")},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})}}}]),angularApp.controller("grupoEditCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","Grupo","$modalInstance",function(e,o,a,t,r,n,l){e.modalInstance=l,t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin"),e.object={},e.noChanges=!0,e.object.name=n.name,e.object.description=n.description,e.checkStatus=function(){e.noChanges=n.name==e.object.name&&n.description==e.object.description?!0:!1},e.update=function(){e.group={name:e.object.name,description:e.object.description};var o=a.all("group/"+n.id+"/update");o.post(e.group).then(function(e){"updated"==e?(alert("El grupo se actualizo correctamente"),l.close()):alert("Hubo un error al actualizar el grupo. Intentelo de nuevo")},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})}}]),angularApp.controller("usuarioReadCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","$route","$timeout",function(e,o,a,t,r,n){t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin");var l=a.one("user");l.get().then(function(o){e.usuarios=o},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))}),e.remove=function(e){var o=a.all("user/"+e+"/delete");o.post().then(function(e){"removed"==e&&(alert("El usuario se elimino correctamente"),n.reload())},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})}}]),angularApp.controller("usuarioEditCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","$routeParams","$route","$modal",function(e,o,a,t,r,n,l,s){t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin"),e.noChanges=!0;var i=n.id,c=a.one("user");c.get({userid:i}).then(function(o){e.usuario=o,e.object={},e.object.name=e.usuario.name,e.object.surname=e.usuario.surname,e.object.email=e.usuario.email,e.object.phone=e.usuario.phone},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))}),e.checkStatus=function(){e.noChanges=e.usuario.name==e.object.name&&e.usuario.surname==e.object.surname&&e.object.phone==e.usuario.phone?!0:!1},e.update=function(){var o=a.all("user/"+e.usuario.id+"/update");e.usuario={name:e.object.name,surname:e.object.surname,phone:e.object.phone},o.post(e.usuario).then(function(){alert("Los datos se actualizaron correctamente"),l.reload()},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})};var u=a.one("group");u.get({userid:i}).then(function(o){e.grupos=o},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))});var d=a.one("user/"+i+"/group");d.get().then(function(o){e.gruposAll=o},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))}),e.asociarGrupoOpen=function(){d.get().then(function(o){e.gruposAll=o},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))}),s.open({templateUrl:"admin-app/views/usuario/modal-view-grupo.html",controller:"ModalGrupoReadCtrl",backdrop:"static",windowClass:"big-modal",keyboard:!0,scope:e,resolve:{Grupo:function(){return e.gruposAll}}}).result.then(function(e){var o=a.all("user/"+i+"/group/asociar");o.post({group_id:e}).then(function(){alert("Se han actualizado los grupos correctamente"),l.reload()},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})})},e.desasociarGrupo=function(e){var o=a.all("user/"+i+"/group/desasociar");o.post({group_id:e.id}).then(function(e){"desasociado"==e&&(alert("El usuario ya no pertenece al grupo"),l.reload())},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))})},e.recoveryPassword=function(){var o=a.all("user/password/recovery");o.post({email:e.usuario.email}).then(function(){alert("Se ha enviado un mail a su casilla para recuperar la contraseña"),l.reload()},function(){alert("Ha ocurrido un error inesperado.Intentelo de nuevo")})}}]),angularApp.controller("ModalGrupoReadCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","Grupo","$modalInstance",function(e,o,a,t,r,n,l){t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png"},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.modalInstance=l,e.groups=n,e.loggedUser||r.path("/admin"),angular.forEach(e.groups,function(e){e.selected="1"==e.selected}),console.log(e.grupos),e.select=function(e){l.close(e)},e.saveGrupos=function(){var o=[];angular.forEach(e.groups,function(e){1==e.selected&&o.push(e.id)}),e.modalInstance.close(o)}}]),angularApp.controller("stockReadCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","$modal","$timeout",function(e,o,a,t,r,n){t.init(),e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png";var o=a.one("user/"+e.loggedUser.id+"/admin");o.get().then(function(){})},e.remove=function(e){var o=a.all("stock/"+e+"/delete");o.post().then(function(){alert("El vehiculo se ha eliminado correctamente"),$route.reload()},function(){alert("Se ha producido un error,vuelva a intentarlo")})},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin");var l=a.one("stock");l.get().then(function(o){e.stock=o}),e.openCreateStock=function(){n.open({templateUrl:"admin-app/views/stock/view-create-stock.html",controller:"stockCreateCtrl",backdrop:"static",windowClass:"big-modal",keyboard:!0,scope:e}).result.then(function(){t.reload()})}}]),angularApp.controller("stockCreateCtrl",["$scope","$rootScope","Restangular","GlobalFactory","$location","$modal","$timeout","$modalInstance",function(e,o,a,t,r,n,l,s){t.init(),e.currentTab=0,e.object={},e.modalInstance=s,e.object.combustible="5",e.object.color="",e.object.version="",e.object.titular="",e.object.kilometros="",e.object.color="",e.object.chasis="",e.object.tipo="1",e.loadImage=function(){e.profileUrl=e.loggedUser.image_url?e.loggedUser.image_url:"src/images/perfil.png";var o=a.one("user/"+e.loggedUser.id+"/admin");o.get().then(function(){})},e.close=function(){s.dismiss()},e.$watch(function(){return o.loggedUser},function(o,a){o!=a&&(e.loggedUser=o,e.loadImage())}),e.loggedUser||r.path("/admin");var i=a.one("stock/combutibles");i.get().then(function(o){e.combustibles=o,console.log(e.combustibles)});var c=a.one("stock/tipos");c.get().then(function(o){e.tipos=o});var u=a.one("caracteristicas");u.get().then(function(o){e.caracteristicas=o,e.caracteristicas.forEach(function(e){e.val=!1})},function(e){401==e.status&&(alert("ACCESO NO AUTORIZADO"),r.path("/admin"))}),e.changeFeatures=function(o,a){e.caracteristicas[o].val=1==a?!0:!1},e.save=function(){console.log(e.caracteristicas);var o=[];e.caracteristicas.forEach(function(e){1==e.val&&o.push(e.id)});var t=a.all("stock/create");t.post({datos:e.object,caracteristicas:o}).then(function(){alert("El vehiculo se agrego al stock correctamente"),s.close()},function(e){400==e.status&&alert("El dominio del vehiculo ya fue agregado"),401==e.status?(alert("ACCESO NO AUTORIZADO"),r.path("/admin")):alert("Error al agregar vehiculo")})}}]);